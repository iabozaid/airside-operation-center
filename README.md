# Airside Operation Center (AOC)

> [!IMPORTANT]
> **DEMO ENVIRONMENT DISCLAIMER**
> This project is configured for a **local demo environment**.
> - **Authentication**: Uses local in-memory/DB credentials (default: `admin` / `admin`). Not for production use.
> - **Simulation**: Events are generated by an internal simulation engine (`/simulation` context).
> - **Hardware Adapters**: Robot and Vehicle telemetry is emulated. No physical hardware connection.
> - **Infrastructure**: Intended to run as native processes (No Docker required).

## Architecture
- **Backend**: Python 3.11+ (tested in demo environment on Python 3.12 / 3.14), FastAPI, Hexagonal Architecture.
- **Frontend**: React 18 + Vite (No UI Kits).
- **Database**: PostgreSQL 16 (Native Service).
- **Event Backbone**: Redis Streams (Native Service).
- **Infrastructure**: Native Windows Services & Python `venv`.

## Quick Start (Windows)

### Prerequisites
1. **PostgreSQL**: Ensure service is running on port `5432`.
2. **Redis**: Ensure service is running on port `6379`.

### 1. Backend Setup
```powershell
cd backend
python -m venv venv
.\venv\Scripts\Activate.ps1
pip install poetry
poetry install
python src/main.py # Runs via Uvicorn on port 8000
```
*Note: The application will auto-initialize the database schema and Redis consumer groups on first run.*

### 2. Frontend Setup
```powershell
cd frontend
npm install
npm run dev
```
Access the dashboard at [http://localhost:5173](http://localhost:5173).

## Project Structure

### Backend (`/backend/src`)
- `identity/`: Auth, Users, Roles
- `soc/`: Incidents, State Machine
- `tickets/`: Ticketing, Escalations
- `fleet/`: Assets, Status
- `simulation/`: Scenario Engine
- `shared/`: EventBus, Consumers
- `infrastructure/`: Database, Settings

### Frontend (`/frontend/src`)
- `api/`: API Client (SSE, HTTP)
- `state/`: Event Reducer (Global State)
- `pages/`: Page Components (Ops, Tickets, Fleet, Analytics)
- `layout/`: Main App Shell

## Event Backbone (Redis Streams)

 The system uses **Redis Streams** (`stream:events:global`) as the central nervous system, not just a cache.
 
 - **Stream Name**: `stream:events:global` (All canonical events)
 - **Correlation ID**: Critical for linking Incidents to their underlying Signals and subsequent Tickets.
 
### Consumer Groups
- `cg:soc-core`: Processes raw signals into Incidents.
- `cg:read-models`: Updates PostgreSQL query tables (Ops Dashboard state).
- `cg:analytics`: Aggregates metrics for the Analytics Dashboard.
- `cg:frontend-fanout`: Proxies events to Frontend via SSE.

### Envelope Contract
```json
{
  "event_id": "UUID",
  "event_type": "string",
  "source_context": "baggage|vms|fleet|soc|ticketing|admin",
  "severity": "info|warning|critical",
  "timestamp": "ISO8601",
  "correlation_id": "UUID",
  "entity_refs": {},
  "payload": {}
}
```

## Asset Status Monitoring

The Fleet context tracks asset lifecycle states which determine operational availability.

### Status Lifecycle
- **IN_SERVICE**: Fully operational and assignable. Visible on the Ops Map.
- **OUT_OF_SERVICE_MAINTENANCE**: Down for scheduled repair.
- **OUT_OF_SERVICE_CHARGING**: Currently recharging (Robot/Vehicle).
- **OFFLINE**: Loss of telemetry heartbeat.

*Note: Only assets with `IN_SERVICE` status are rendered on the Live Map layer. Asset health adds to the "Fleet Uptime" metric but is decoupled from Incident generation unless a specific `fleet.asset.fault` event occurs.*

## Simulation
To test the system without real hardware:
1. Go to **Simulation Control** (`/simulation`).
2. Select a scenario (e.g., "Fleet Safety").
3. Click **Run**.
4. Observe incidents appearing in the **Unified Operations Console** (`/ops`).
